<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Mobil Hindari Rintangan</title>

<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #333;
        color: white;
        margin: 0;
        padding: 10px;
    }

    canvas {
        border: 2px solid white;
        background-color: #222;
        display: none; /* disembunyikan sebelum play */
        margin: auto;
    }

    .score {
        font-size: 18px;
        margin-top: 10px;
        display: none;
    }

    .controls {
        margin-top: 15px;
        display: none;
    }

    button {
        font-size: 20px;
        padding: 12px 25px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        background-color: #1e90ff;
        color: white;
    }

    button:active {
        background-color: #0f5fa8;
    }

    #playScreen {
        margin-top: 100px;
    }

    audio {
        display: none;
    }
</style>
</head>
<body>

<h2>Game Mobil</h2>

<!-- SCREEN PLAY -->
<div id="playScreen">
    <p>Tekan tombol untuk mulai bermain üöó</p>
    <button id="playBtn">‚ñ∂Ô∏è PLAY</button>
</div>

<!-- GAME -->
<canvas id="gameCanvas" width="360" height="540"></canvas>

<div class="score">
    Skor: <span id="score">0</span> |
    High Score: <span id="highScore">0</span>
</div>

<div class="controls">
    <button id="leftBtn">‚¨ÖÔ∏è</button>
    <button id="rightBtn">‚û°Ô∏è</button>
</div>

<audio id="bgMusic" src="Backsound alur cerita di Facebook.mp3" loop></audio>

<script>
/* ===== SETUP ===== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const scoreEl = document.getElementById("score");
const highScoreEl = document.getElementById("highScore");
const bgMusic = document.getElementById("bgMusic");

const playBtn = document.getElementById("playBtn");
const playScreen = document.getElementById("playScreen");
const scoreBox = document.querySelector(".score");
const controls = document.querySelector(".controls");

/* ===== VARIABEL GAME ===== */
const playerWidth = 50;
const playerHeight = 80;
let playerX, playerY;
let playerSpeed = 10;

let obstacles = [];
let obstacleSpeed = 3;

let score = 0;
let gameRunning = false;

let highScore = localStorage.getItem("highScore") || 0;
highScoreEl.textContent = highScore;

/* ===== GAMBAR MOBIL ===== */
function drawPlayer() {
    ctx.fillStyle = "#1e90ff";
    ctx.fillRect(playerX, playerY, playerWidth, playerHeight);

    ctx.fillStyle = "#b0e0ff";
    ctx.fillRect(playerX + 8, playerY + 10, playerWidth - 16, 20);
    ctx.fillRect(playerX + 8, playerY + playerHeight - 30, playerWidth - 16, 15);

    ctx.fillStyle = "black";
    ctx.fillRect(playerX - 5, playerY + 15, 5, 20);
    ctx.fillRect(playerX - 5, playerY + playerHeight - 35, 5, 20);
    ctx.fillRect(playerX + playerWidth, playerY + 15, 5, 20);
    ctx.fillRect(playerX + playerWidth, playerY + playerHeight - 35, 5, 20);
}

/* ===== RINTANGAN ===== */
function drawObstacles() {
    ctx.fillStyle = "red";
    obstacles.forEach(o => {
        ctx.fillRect(o.x, o.y, o.width, o.height);
    });
}

function updateObstacles() {
    obstacles.forEach(o => o.y += obstacleSpeed);
    obstacles = obstacles.filter(o => o.y < canvas.height);

    if (Math.random() < 0.03) {
        const size = 50;
        obstacles.push({
            x: Math.random() * (canvas.width - size),
            y: -size,
            width: size,
            height: size
        });
    }
}

/* ===== TABRAKAN ===== */
function checkCollision() {
    for (let o of obstacles) {
        if (
            playerX < o.x + o.width &&
            playerX + playerWidth > o.x &&
            playerY < o.y + o.height &&
            playerY + playerHeight > o.y
        ) {
            gameRunning = false;

            if (score > highScore) {
                highScore = score;
                localStorage.setItem("highScore", highScore);
            }

            bgMusic.pause();
            alert(`GAME OVER\nSkor: ${score}\nHigh Score: ${highScore}`);
            location.reload();
        }
    }
}

/* ===== SKOR ===== */
function updateScore() {
    score++;
    scoreEl.textContent = score;
}

/* ===== GAME LOOP ===== */
function gameLoop() {
    if (!gameRunning) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawPlayer();
    drawObstacles();
    updateObstacles();
    checkCollision();
    updateScore();

    requestAnimationFrame(gameLoop);
}

/* ===== PLAY BUTTON ===== */
playBtn.addEventListener("click", () => {
    playScreen.style.display = "none";
    canvas.style.display = "block";
    scoreBox.style.display = "block";
    controls.style.display = "block";

    playerX = canvas.width / 2 - playerWidth / 2;
    playerY = canvas.height - playerHeight - 10;
    obstacles = [];
    score = 0;

    bgMusic.play();       // musik mulai
    gameRunning = true;   // game mulai
    gameLoop();
});

/* ===== KEYBOARD ===== */
document.addEventListener("keydown", e => {
    if (!gameRunning) return;
    if (e.key === "ArrowLeft" && playerX > 0) playerX -= playerSpeed;
    if (e.key === "ArrowRight" && playerX < canvas.width - playerWidth)
        playerX += playerSpeed;
});

/* ===== TOUCH (HP) ===== */
leftBtn.addEventListener("touchstart", e => {
    e.preventDefault();
    if (playerX > 0) playerX -= playerSpeed * 2;
});

rightBtn.addEventListener("touchstart", e => {
    e.preventDefault();
    if (playerX < canvas.width - playerWidth)
        playerX += playerSpeed * 2;
});
</script>

</body>
</html>
